
    <div class="input-bar backdrop-blur-xs">
        <div *ngIf="userTyping" class="input-spinner-row absolute top-[-2.5rem]">
        <span class="spinner-text">{{ userTyping + " is typing"}}</span>
        <div class="spinner">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
        <!-- Pin Button -->
        <button
            id="pin-button"
            [ngClass]="{'has-files': hasFiles}"
            (click)="toggleFileForm()"
        class="w-11 h-11">
            <span *ngIf="hasFiles" class="file-count-circle">
                {{ fileCount }}
            </span>
            <svg *ngIf="!hasFiles" viewBox="0 0 24.00 24.00" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#000000" stroke-width="0.00024000000000000003"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.2443 1.95482C12.9442 1.01506 15.0346 1.01506 16.7345 1.95482C17.3642 2.30291 17.9519 2.86575 18.9066 3.78015C18.9374 3.80965 18.9686 3.83952 19.0002 3.86977C19.0332 3.90137 19.0657 3.93255 19.0979 3.96334C20.0489 4.87363 20.6381 5.43761 21.0039 6.04433C21.9987 7.69404 21.9987 9.73123 21.0039 11.3809C20.6381 11.9877 20.0489 12.5517 19.0979 13.4619C19.0657 13.4927 19.0332 13.5239 19.0002 13.5555L11.5432 20.6955C11.0139 21.2023 10.5826 21.6153 10.2031 21.9215C9.80997 22.2385 9.42288 22.4831 8.96849 22.6137C8.3365 22.7954 7.66344 22.7954 7.03145 22.6137C6.57706 22.4831 6.18997 22.2385 5.79685 21.9215C5.41736 21.6154 4.98604 21.2024 4.4568 20.6956L4.40896 20.6498C3.88006 20.1434 3.44862 19.7303 3.12862 19.3666C2.79815 18.991 2.53687 18.6144 2.3962 18.1659C2.20127 17.5443 2.20127 16.8808 2.3962 16.2592C2.53687 15.8107 2.79815 15.4341 3.12862 15.0585C3.44862 14.6948 3.88007 14.2817 4.40896 13.7753L11.7594 6.7372C11.7858 6.712 11.8118 6.68704 11.8375 6.66235C12.2069 6.30782 12.5188 6.00843 12.8793 5.8422C13.5141 5.54951 14.2508 5.54951 14.8856 5.8422C15.2461 6.00843 15.558 6.30782 15.9274 6.66235C15.9531 6.68704 15.9791 6.712 16.0055 6.7372C16.0327 6.76328 16.0597 6.78906 16.0864 6.81458C16.4534 7.16504 16.769 7.46639 16.946 7.81825C17.2623 8.44722 17.2623 9.18288 16.946 9.81184C16.842 10.0185 16.7035 10.19 16.555 10.3498C16.4132 10.5025 16.2317 10.6763 16.0205 10.8785L8.62562 17.9591C8.32644 18.2455 7.85167 18.2352 7.56521 17.936C7.27874 17.6369 7.28905 17.1621 7.58823 16.8756L14.9681 9.80945C15.1985 9.58884 15.3477 9.4455 15.4559 9.329C15.5607 9.21618 15.5928 9.16394 15.6059 9.13786C15.709 8.93291 15.709 8.69718 15.6059 8.49224C15.5616 8.40415 15.4629 8.29447 14.9681 7.82064C14.4761 7.34963 14.3581 7.25076 14.2575 7.20436C14.0213 7.09546 13.7436 7.09546 13.5074 7.20436C13.4068 7.25075 13.2887 7.34963 12.7968 7.82064L5.47047 14.8356C4.91163 15.3707 4.52727 15.7396 4.2548 16.0493C3.98794 16.3526 3.87862 16.5449 3.82747 16.7081C3.72418 17.0374 3.72418 17.3877 3.82747 17.717C3.87862 17.8801 3.98794 18.0724 4.2548 18.3758C4.52727 18.6855 4.91163 19.0544 5.47047 19.5895C6.02912 20.1244 6.41466 20.4926 6.73859 20.7539C7.05455 21.0088 7.26154 21.1191 7.44595 21.1721C7.80709 21.276 8.19285 21.276 8.55399 21.1721C8.7384 21.1191 8.94539 21.0088 9.26135 20.7539C9.58528 20.4926 9.97082 20.1244 10.5295 19.5895L17.9628 12.4721C19.0429 11.4379 19.4703 11.0194 19.7194 10.6064C20.4269 9.43309 20.4269 7.99218 19.7194 6.81888C19.4703 6.40585 19.0429 5.98742 17.9628 4.9532C16.8844 3.92069 16.4453 3.50886 16.0088 3.26758C14.7605 2.57747 13.2183 2.57747 11.97 3.26758C11.5335 3.50886 11.0944 3.92069 10.016 4.9532L4.02659 10.6881C3.72741 10.9745 3.25265 10.9642 2.96618 10.665C2.67971 10.3659 2.69002 9.8911 2.9892 9.60464L8.97863 3.86977C9.01022 3.83952 9.04141 3.80965 9.07222 3.78014C10.0269 2.86575 10.6146 2.30291 11.2443 1.95482Z" fill="#ffffff"></path> </g></svg>
        </button>

        <!-- Emoji Button -->
        <button id="emoji-button" (click)="toggleEmojiPopup()" class="w-11 h-11">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" stroke-width="0.00024000000000000003"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M15.4754 9.51572C15.6898 10.3159 15.4311 11.0805 14.8977 11.2234C14.3642 11.3664 13.7579 10.8336 13.5435 10.0334C13.3291 9.23316 13.5877 8.4686 14.1212 8.32565C14.6547 8.18271 15.2609 8.71552 15.4754 9.51572Z" fill="#ffffff"></path> <path d="M9.67994 11.0687C9.89436 11.8689 9.63571 12.6335 9.10225 12.7764C8.56878 12.9194 7.9625 12.3865 7.74809 11.5863C7.53368 10.7861 7.79232 10.0216 8.32579 9.87863C8.85925 9.73569 9.46553 10.2685 9.67994 11.0687Z" fill="#ffffff"></path> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.75C6.89137 2.75 2.75 6.89137 2.75 12C2.75 17.1086 6.89137 21.25 12 21.25C17.1086 21.25 21.25 17.1086 21.25 12C21.25 6.89137 17.1086 2.75 12 2.75ZM1.25 12C1.25 6.06294 6.06294 1.25 12 1.25C17.9371 1.25 22.75 6.06294 22.75 12C22.75 17.9371 17.9371 22.75 12 22.75C6.06294 22.75 1.25 17.9371 1.25 12ZM17.1789 13.3409C17.467 13.6385 17.4593 14.1133 17.1617 14.4014C16.9917 14.566 16.8128 14.7246 16.6256 14.8766L16.8441 15.3216C17.3971 16.4482 16.9214 17.8094 15.787 18.3464C14.6752 18.8728 13.3468 18.4085 12.8047 17.3043L12.5315 16.7477C11.2117 16.998 9.90919 16.9561 8.73026 16.6606C8.32847 16.5599 8.0844 16.1526 8.1851 15.7508C8.2858 15.349 8.69315 15.1049 9.09494 15.2056C10.2252 15.4889 11.5232 15.4924 12.841 15.1393C14.1588 14.7862 15.2811 14.1342 16.1183 13.3237C16.4159 13.0356 16.8908 13.0433 17.1789 13.3409ZM14.0048 16.345L14.1513 16.6433C14.3319 17.0114 14.7747 17.1661 15.1452 16.9907C15.5233 16.8117 15.6818 16.358 15.4975 15.9825L15.3707 15.7241C14.9417 15.9631 14.4851 16.1716 14.0048 16.345Z" fill="#ffffff"></path> </g></svg>
        </button>

        <!-- Textarea -->
        <div class="custom-scrollbar-container" #customScrollbarContainer>
            <textarea 
                id="chat-textarea" 
                #chatTextarea
                placeholder="Napište zprávu..." 
                (input)="onInput()"
                (scroll)="onScroll()"
            ></textarea>
            <!-- Vlastní scrollbar -->
            <div class="custom-scrollbar-track" #customScrollbarTrack>
                <div id="custom-scrollbar-thumb" class="custom-scrollbar-thumb" #customScrollbarThumb (mousedown)="onThumbMouseDown($event)"></div>
            </div>
        </div>

        <!-- Emoji Popup -->
        <div *ngIf="emojiPopupService.emojiPopupVisible" class="absolute bottom-full left-1/2" style="transform:translateX(-50%);margin-bottom:0.5rem;z-index:50;">
            <app-emoji (emojiSelected)="onEmojiSelected($event)"></app-emoji>
        </div>

        <!-- Send Button -->
        <button id="send-button" (click)="send()" class="w-11 h-11">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#000000" stroke-width="0.00024000000000000003"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M18.1437 3.63083C16.9737 3.83896 15.3964 4.36262 13.1827 5.10051L8.17141 6.77094C6.39139 7.36428 5.1021 7.79468 4.19146 8.182C3.23939 8.58693 2.90071 8.86919 2.79071 9.0584C2.45191 9.64118 2.45191 10.361 2.79071 10.9437C2.90071 11.1329 3.23939 11.4152 4.19146 11.8201C5.1021 12.2075 6.39139 12.6379 8.17141 13.2312C8.19952 13.2406 8.22727 13.2498 8.25468 13.2589C8.63431 13.3852 8.94795 13.4895 9.22198 13.6328L14.5454 8.36811C14.8471 8.06974 15.3335 8.07243 15.6319 8.37413C15.9303 8.67583 15.9276 9.16229 15.6259 9.46067L10.3259 14.7022C10.4912 14.994 10.603 15.3302 10.7411 15.7453C10.7502 15.7727 10.7594 15.8005 10.7688 15.8286C11.3621 17.6086 11.7925 18.8979 12.1799 19.8085C12.5848 20.7606 12.867 21.0993 13.0563 21.2093C13.639 21.5481 14.3588 21.5481 14.9416 21.2093C15.1308 21.0993 15.4131 20.7606 15.818 19.8085C16.2053 18.8979 16.6357 17.6086 17.2291 15.8286L18.8995 10.8173C19.6374 8.60363 20.161 7.02627 20.3692 5.85629C20.5783 4.68074 20.4185 4.1814 20.1185 3.88146C19.8186 3.58152 19.3193 3.42171 18.1437 3.63083ZM17.8746 2.11797C19.1768 1.88632 20.3496 1.93941 21.2051 2.79491C22.0606 3.65041 22.1137 4.82322 21.882 6.12542C21.6518 7.41975 21.0903 9.10415 20.3794 11.2367L18.6745 16.3515C18.096 18.0869 17.6465 19.4354 17.232 20.41C16.8322 21.35 16.3882 22.1457 15.7139 22.5377C14.6537 23.1541 13.3442 23.1541 12.284 22.5377C11.6096 22.1457 11.1657 21.35 10.7658 20.41C10.3513 19.4354 9.90184 18.0869 9.32338 16.3515L9.31105 16.3145C9.10838 15.7065 9.04661 15.5416 8.95909 15.4109C8.86114 15.2646 8.73545 15.1389 8.58913 15.0409C8.4584 14.9534 8.29348 14.8916 7.68549 14.689L7.64845 14.6766C5.91306 14.0982 4.56463 13.6487 3.59005 13.2342C2.64996 12.8343 1.85431 12.3904 1.46228 11.716C0.845907 10.6558 0.845908 9.34634 1.46228 8.28611C1.85431 7.61177 2.64996 7.16781 3.59005 6.76797C4.56464 6.35345 5.91309 5.90397 7.64852 5.3255L12.7633 3.62057C14.8959 2.9097 16.5803 2.34822 17.8746 2.11797Z" fill="#ffffff"></path> </g></svg>
        </button>
    </div>


